# ============================================================================
# Expense Tracker - Environment Variables Configuration
# ============================================================================
# Copy this file to .env and adjust values for your environment
# cp .env.example .env

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
POSTGRES_DB=expense_tracker
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

# PostgreSQL Performance Tuning (for load testing)
# Adjust based on available system memory
# These are CONSERVATIVE defaults that won't cause OOM
POSTGRES_SHARED_BUFFERS=256MB          # Start conservative, increase if needed
POSTGRES_WORK_MEM=8MB                  # Memory per sort/hash operation
POSTGRES_MAINTENANCE_WORK_MEM=128MB    # Memory for maintenance operations
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB      # OS cache estimate (can increase to 2-4GB if stable)
POSTGRES_MAX_CONNECTIONS=100           # Max concurrent connections

# For high-performance systems (16GB+ RAM), you can increase to:
# POSTGRES_SHARED_BUFFERS=512MB
# POSTGRES_WORK_MEM=16MB
# POSTGRES_MAINTENANCE_WORK_MEM=256MB
# POSTGRES_EFFECTIVE_CACHE_SIZE=4GB

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
SPRING_PROFILE=dev

# JWT Secret - CHANGE THIS IN PRODUCTION!
JWT_SECRET=change_this_to_a_secure_base64_key_in_production

# ============================================================================
# HIKARICP CONNECTION POOL (for load testing)
# ============================================================================
# Rule of thumb: connections = ((core_count * 2) + effective_spindle_count)
# For 100 concurrent users with virtual threads: 20-30 connections is sufficient
HIKARI_MAX_POOL_SIZE=30                # Maximum pool size
HIKARI_MIN_IDLE=10                     # Minimum idle connections
HIKARI_CONNECTION_TIMEOUT=30000        # Connection timeout (ms)
HIKARI_IDLE_TIMEOUT=600000             # Idle timeout (ms) - 10 minutes
HIKARI_MAX_LIFETIME=1800000            # Max connection lifetime (ms) - 30 minutes
HIKARI_LEAK_DETECTION=60000            # Leak detection threshold (ms)

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
# Grafana
GRAFANA_USER=admin
GRAFANA_PASSWORD=admin

# ============================================================================
# PAYMENT GATEWAY (Midtrans) - Optional
# ============================================================================
# Get your keys from: https://dashboard.midtrans.com/
# MIDTRANS_SERVER_KEY=your-server-key
# MIDTRANS_CLIENT_KEY=your-client-key
# MIDTRANS_API_URL=https://app.sandbox.midtrans.com
# MIDTRANS_IS_PRODUCTION=false

# ============================================================================
# SUBSCRIPTION CONFIGURATION
# ============================================================================
TRIAL_DAYS=14

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
# Log levels for performance tuning
# Use INFO for load testing (minimal overhead)
# Use DEBUG for development/troubleshooting
LOGGING_LEVEL_ROOT=INFO                # Root logger level
LOGGING_LEVEL_APP=INFO                 # Application logger level

# SQL Debugging (WARNING: High overhead, only use for troubleshooting)
# LOGGING_LEVEL_ORG_HIBERNATE_SQL=DEBUG
# LOGGING_LEVEL_ORG_HIBERNATE_TYPE_DESCRIPTOR_SQL_BASICBINDER=TRACE

# ============================================================================
# PERFORMANCE TUNING NOTES
# ============================================================================
#
# 1. HikariCP Pool Size:
#    - Start with 20-30 for 100 concurrent users
#    - Monitor: curl http://localhost:8081/v1/api/actuator/metrics/hikaricp.connections.active
#    - Increase if you see connection timeouts
#    - Don't exceed PostgreSQL max_connections
#
# 2. PostgreSQL Shared Buffers:
#    - Set to 25% of available RAM
#    - For 8GB system: 2GB, For 16GB system: 4GB
#
# 3. PostgreSQL Effective Cache Size:
#    - Set to 50-75% of available RAM
#    - For 8GB system: 4-6GB, For 16GB system: 8-12GB
#
# 4. Container Memory Limits (set in docker-compose.yml):
#    - App: 4GB limit, 2GB reservation
#    - DB:  3GB limit, 2GB reservation
#
# 5. For Load Testing (100 users):
#    - App container: 4-6GB recommended
#    - DB container:  3-4GB recommended
#    - Leave 2-4GB for host OS
#
# ============================================================================
