spring:
  application:
    name: expense-tracker
  threads:
    virtual:
      enabled: true  # Enable Java 25 virtual threads for better performance and scalability
  datasource:
    url: jdbc:postgresql://localhost:5432/expense_tracker_db?timezone=Asia/Jakarta
    username:
    password:
    driver-class-name: org.postgresql.Driver
    # HikariCP Connection Pool Configuration (for load testing)
    hikari:
      maximum-pool-size: 20  # Max connections (adjust based on load)
      minimum-idle: 5  # Min idle connections
      connection-timeout: 30000  # 30 seconds
      idle-timeout: 600000  # 10 minutes
      max-lifetime: 1800000  # 30 minutes
      leak-detection-threshold: 60000  # Detect leaks after 60 seconds
  flyway:
    enabled: true
    locations: classpath:db/migration
    allow-unsupported-database: true
  profiles:
    active: dev
  jackson:
    time-zone: Asia/Jakarta
    serialization:
      write-dates-as-timestamps: false
  jpa:
    properties:
      hibernate:
        jdbc:
          time_zone: Asia/Jakarta
          batch_size: 50  # Enable batch inserts/updates (50 statements per batch)
          fetch_size: 50  # Optimize fetch size for bulk reads
        order_inserts: true  # Order inserts for better batching
        order_updates: true  # Order updates for better batching
        batch_versioned_data: true  # Enable batch updates for versioned entities
    # Disable open-in-view to prevent lazy loading issues outside transaction
    open-in-view: false

server:
  port: 8081
  address: 0.0.0.0
  servlet:
    context-path: /api/v1

# JWT secret used by JwtUtil. Replace with a secure value in production.
# It can be a plain long string or a base64-encoded key. Example (NOT SECURE):
# jwt:
#   secret: change_this_to_a_secure_base64_key
jwt:
  secret: JwtSecretKeyForExpenseTrackerApplicationChangeMe!

# Midtrans Payment Gateway Configuration
# Get your keys from: https://dashboard.midtrans.com/ (Account > Access Keys)
# Sandbox for testing, Production for live transactions
midtrans:
  server-key: ${MIDTRANS_SERVER_KEY}
  client-key: ${MIDTRANS_CLIENT_KEY}
  api-url: ${MIDTRANS_API_URL:https://app.sandbox.midtrans.com}
  is-production: ${MIDTRANS_IS_PRODUCTION:false}

# Spring Boot Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    tags:
      application: ${spring.application.name}
  info:
    env:
      enabled: true
    build:
      enabled: true
    git:
      enabled: true
      mode: full

# Default Wallet Configuration
app:
  wallet:
    default-name: ${DEFAULT_WALLET_NAME:Dompet Saya}
    default-currency: ${DEFAULT_WALLET_CURRENCY:IDR}
  subscription:
    trial-days: ${TRIAL_DAYS:14}  # Trial duration in days (default: 14)

# Logging Configuration
logging:
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
  level:
    root: INFO
    com.fajars.expensetracker: DEBUG  # Changed from DEBUG to reduce logging overhead
    # For debugging SQL queries, uncomment below (but disable in load testing):
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
